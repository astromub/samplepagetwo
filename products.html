---
layout: default
title: ASTROMub Store - All Products
permalink: /products/
---

<div style="padding: 60px 5%; max-width: 1200px; margin: 0 auto;">
    <h1 style="font-size: 3rem; margin-bottom: 2rem; text-align:center;">Shop All Products</h1>
    <div id="products-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px;"></div>
</div>

<script src="/samplepagetwo/assets/auth.js"></script>
<script src="/samplepagetwo/assets/cart.js"></script>
<script>
async function loadProducts() {
    try {
        if (!window.supabase) {
            await new Promise(resolve => setTimeout(resolve, 1000));
        }

        const { data: products, error } = await window.supabase
            .from('products')
            .select('*')
            .eq('active', true)
            .order('created_at', { ascending: false });

        if (error) throw error;

        const grid = document.getElementById('products-grid');
        
        if (!products || products.length === 0) {
            grid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: #666;">No products available at the moment.</p>';
            return;
        }

        grid.innerHTML = products.map(product => `
            <div class="product-card" style="border-radius:12px; overflow:hidden; box-shadow:0 4px 20px rgba(0,0,0,0.1); background: white;">
                <img src="${product.image_url || '/samplepagetwo/images/placeholder.jpg'}" 
                     alt="${product.title}" 
                     style="width:100%; height:250px; object-fit:cover; background: #f8f9fa;">
                <div style="padding:20px;">
                    <h3 style="margin-bottom: 10px;">${product.title}</h3>
                    <p style="color:#666; margin:10px 0; font-size: 0.9rem;">${product.description || ''}</p>
                    <p style="color:#666; margin:5px 0; font-size: 0.8rem;">SKU: ${product.sku}</p>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-top: 15px;">
                        <strong style="font-size:1.5rem; color:#007bff;">$${product.price}</strong>
                        <button onclick="buyNow('${product.sku}', ${product.price}, '${product.title}')" 
                                style="background:#007bff; color:white; border:none; padding:10px 20px; border-radius:4px; cursor:pointer; transition: background 0.2s;">
                            Buy Now
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading products:', error);
        document.getElementById('products-grid').innerHTML = 
            '<p style="text-align: center; grid-column: 1 / -1; color: #dc3545;">Error loading products. Please try again later.</p>';
    }
}

async function buyNow(sku, amount, title) {
    try {
        if (!window.supabase) {
            throw new Error('Authentication service not available');
        }

        const { data: { session } } = await window.supabase.auth.getSession();
        if (!session) {
            alert('Please login first to make a purchase!');
            // Trigger login
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) loginBtn.click();
            return;
        }

        const { error } = await window.supabase
            .from('purchases')
            .insert({
                user_id: session.user.id,
                product_sku: sku,
                amount: amount
            });

        if (error) throw error;

        alert(`Thank you! You have successfully purchased "${title}" for $${amount}.`);
        window.location.href = '/samplepagetwo/profile.html';
        
    } catch (error) {
        console.error('Purchase error:', error);
        alert('Purchase failed: ' + error.message);
    }
}

document.addEventListener('DOMContentLoaded', loadProducts);
</script>
